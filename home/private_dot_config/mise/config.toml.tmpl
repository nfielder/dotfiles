min_version = { soft = "2026.1.9" }

[settings]
# General
experimental = false
use_versions_host_track = false

{{- if .work }}
{{- $nexusHost := keepassxcAttribute "workstation" "nexus_host" }}
disable_backends = [ "ubi", "conda", "forgejo", "gem", "gitlab", "spm" ]
use_versions_host = false

# Golang
go_download_mirror = "https://{{ $nexusHost }}/repository/raw-dl-google-com/go"

# Dotnet
[settings.dotnet]
registry_url = "https://{{ $nexusHost }}/repository/nuget-proxy/index.json"

# Python
[settings.pipx]
registry_url = "https://{{ $nexusHost }}/repository/pypi-proxy/simple/{}/"

# Replacements to direct outgoing requests to internal corporate proxy/cache
[settings.url_replacements]
"https://github.com" = "https://{{ $nexusHost }}/repository/raw-github-com"
"https://api.github.com" = "https://{{ $nexusHost }}/repository/raw-api-github-com"
"https://raw.githubusercontent.com" = "https://{{ $nexusHost }}/repository/raw-githubusercontent-com"
"https://mise-versions.jdx.dev" = "https://{{ $nexusHost }}/repository/raw-mise-versions"
"https://mise-java.jdx.dev" = "https://{{ $nexusHost }}/repository/raw-mise-java"
"https://releases.hashicorp.com" = "https://{{ $nexusHost }}/repository/raw-hashicorp-com"
"https://dl.k8s.io" = "https://{{ $nexusHost }}/repository/raw-dl-k8s-io"
"https://pypi.org" = "https://{{ $nexusHost }}/repository/pypi-proxy"
"https://nodejs.org/dist" = "https://{{ $nexusHost }}/repository/raw-nodedist"
{{ end }}

{{- $commonPackages := deepCopy .packages.mise.common -}}
{{- $allPackages := dict }}
{{- if .work -}}
{{-   $allPackages = mustMergeOverwrite $commonPackages .packages.mise.work -}}
{{- else if .personal -}}
{{-   $allPackages = mustMergeOverwrite $commonPackages .packages.mise.personal -}}
{{- end -}}

{{- /* check map is non-empty and not nil */ -}}
{{- if $allPackages }}

[tools]
{{ $allPackages | toToml -}}
{{- end -}}
